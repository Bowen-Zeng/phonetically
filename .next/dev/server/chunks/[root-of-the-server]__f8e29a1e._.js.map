{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/lib/mongodb.ts"],"sourcesContent":["/**\r\n * MongoDB connection - uses MONGODB_URI env variable\r\n * Add to .env.local: MONGODB_URI=mongodb+srv://...\r\n */\r\nimport { MongoClient } from 'mongodb';\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nif (!uri) {\r\n  console.warn('MONGODB_URI not set - therapist dashboard will not persist');\r\n}\r\n\r\nlet client: MongoClient | null = null;\r\n\r\nexport async function getDb() {\r\n  if (!uri) throw new Error('MONGODB_URI not configured');\r\n  if (!client) client = new MongoClient(uri);\r\n  await client.connect();\r\n  return client.db();\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,IAAI,CAAC,KAAK;IACR,QAAQ,IAAI,CAAC;AACf;AAEA,IAAI,SAA6B;AAE1B,eAAe;IACpB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,IAAI,CAAC,QAAQ,SAAS,IAAI,6MAAW,CAAC;IACtC,MAAM,OAAO,OAAO;IACpB,OAAO,OAAO,EAAE;AAClB"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/app/api/dashboard/summary/route.ts"],"sourcesContent":["/**\r\n * GET /api/dashboard/summary?userId=...\r\n * Returns lastSession, recentAttempts, recommendedSound for dashboard\r\n */\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { getDb } from '../../../../lib/mongodb';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const uid = searchParams.get('userId') || 'default';\r\n\r\n    const db = await getDb();\r\n\r\n    const lastSession = await db.collection('sessions').findOne(\r\n      { userId: uid },\r\n      { sort: { startedAt: -1 } }\r\n    );\r\n\r\n    const recentAttempts = await db\r\n      .collection('attempts')\r\n      .find({ userId: uid })\r\n      .sort({ createdAt: -1 })\r\n      .limit(20)\r\n      .project({ word: 1, sound: 1, transcript: 1, accuracy: 1, needsCorrection: 1, createdAt: 1 })\r\n      .toArray();\r\n\r\n    let recommendedSound: string | null = null;\r\n    const attemptsWithSound = recentAttempts.filter((a) => a.sound);\r\n    if (attemptsWithSound.length > 0) {\r\n      const bySound: Record<string, { sum: number; count: number }> = {};\r\n      for (const a of attemptsWithSound) {\r\n        const s = a.sound || 'Other';\r\n        if (!bySound[s]) bySound[s] = { sum: 0, count: 0 };\r\n        bySound[s].sum += a.accuracy;\r\n        bySound[s].count += 1;\r\n      }\r\n      let lowestAvg = 100;\r\n      for (const [sound, { sum, count }] of Object.entries(bySound)) {\r\n        const avg = sum / count;\r\n        if (avg < lowestAvg) {\r\n          lowestAvg = avg;\r\n          recommendedSound = sound;\r\n        }\r\n      }\r\n    } else if (recentAttempts.length > 0) {\r\n      const byWord: Record<string, { sum: number; count: number }> = {};\r\n      for (const a of recentAttempts) {\r\n        const w = a.word || 'unknown';\r\n        if (!byWord[w]) byWord[w] = { sum: 0, count: 0 };\r\n        byWord[w].sum += a.accuracy;\r\n        byWord[w].count += 1;\r\n      }\r\n      let lowestAvg = 100;\r\n      let worstWord = '';\r\n      for (const [word, { sum, count }] of Object.entries(byWord)) {\r\n        const avg = sum / count;\r\n        if (avg < lowestAvg) {\r\n          lowestAvg = avg;\r\n          worstWord = word;\r\n        }\r\n      }\r\n      if (worstWord) recommendedSound = worstWord;\r\n    }\r\n\r\n    return NextResponse.json({\r\n      lastSession: lastSession\r\n        ? {\r\n            sessionId: lastSession._id?.toString(),\r\n            attemptCount: lastSession.attemptCount ?? 0,\r\n            startedAt: lastSession.startedAt,\r\n            endedAt: lastSession.endedAt,\r\n          }\r\n        : null,\r\n      recentAttempts: recentAttempts.map((a) => ({\r\n        word: a.word,\r\n        sound: a.sound,\r\n        transcript: a.transcript,\r\n        accuracy: a.accuracy,\r\n        needsCorrection: a.needsCorrection,\r\n        createdAt: a.createdAt,\r\n      })),\r\n      recommendedSound,\r\n    });\r\n  } catch (e) {\r\n    if (String(e).includes('MONGODB_URI')) {\r\n      return NextResponse.json({ lastSession: null, recentAttempts: [], recommendedSound: null });\r\n    }\r\n    console.error('Dashboard summary error:', e);\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}