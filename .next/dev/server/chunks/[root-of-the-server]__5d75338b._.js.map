{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/lib/mongoose.ts"],"sourcesContent":["/**\r\n * Mongoose connection for Phona practice (Sessions, Attempts)\r\n * Uses MONGODB_URI env variable - connect once, reuse across requests\r\n */\r\nimport mongoose from 'mongoose';\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI;\r\n\r\nif (!MONGODB_URI) {\r\n  console.warn('MONGODB_URI not set - Phona practice persistence disabled');\r\n}\r\n\r\nlet conn: typeof mongoose | null = null;\r\n\r\nexport async function connectDb(): Promise<typeof mongoose> {\r\n  if (!MONGODB_URI) throw new Error('MONGODB_URI not configured');\r\n  if (conn) return conn;\r\n  conn = await mongoose.connect(MONGODB_URI);\r\n  return conn;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,QAAQ,IAAI,CAAC;AACf;AAEA,IAAI,OAA+B;AAE5B,eAAe;IACpB,IAAI,CAAC,aAAa,MAAM,IAAI,MAAM;IAClC,IAAI,MAAM,OAAO;IACjB,OAAO,MAAM,4MAAQ,CAAC,OAAO,CAAC;IAC9B,OAAO;AACT"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/lib/models/Attempt.ts"],"sourcesContent":["/**\r\n * Attempt model - single pronunciation attempt\r\n * Schema: userId, sessionId, word, syllables[], transcript, accuracy, needsCorrection, createdAt\r\n */\r\nimport mongoose from 'mongoose';\r\n\r\nconst AttemptSchema = new mongoose.Schema(\r\n  {\r\n    userId: { type: String, required: true },\r\n    sessionId: { type: mongoose.Schema.Types.ObjectId, ref: 'Session' },\r\n    word: { type: String, required: true },\r\n    syllables: [{ type: String }],\r\n    transcript: { type: String, default: '' },\r\n    accuracy: { type: Number, required: true },\r\n    needsCorrection: { type: Boolean, default: false },\r\n  },\r\n  { timestamps: true }\r\n);\r\n\r\nexport default mongoose.models.Attempt || mongoose.model('Attempt', AttemptSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;;AAEA,MAAM,gBAAgB,IAAI,4MAAQ,CAAC,MAAM,CACvC;IACE,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,WAAW;QAAE,MAAM,4MAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;IAAU;IAClE,MAAM;QAAE,MAAM;QAAQ,UAAU;IAAK;IACrC,WAAW;QAAC;YAAE,MAAM;QAAO;KAAE;IAC7B,YAAY;QAAE,MAAM;QAAQ,SAAS;IAAG;IACxC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,iBAAiB;QAAE,MAAM;QAAS,SAAS;IAAM;AACnD,GACA;IAAE,YAAY;AAAK;uCAGN,4MAAQ,CAAC,MAAM,CAAC,OAAO,IAAI,4MAAQ,CAAC,KAAK,CAAC,WAAW"}},
    {"offset": {"line": 117, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/lib/utils/syllables.ts"],"sourcesContent":["/**\r\n * Basic syllable splitter - placeholder for future replacement\r\n * Splits before vowel groups, returns 2-5 chunks\r\n */\r\nexport function splitSyllables(word: string): string[] {\r\n  const normalized = word.trim().toLowerCase().replace(/[^a-z]/g, '');\r\n  if (!normalized) return [word];\r\n\r\n  const parts: string[] = [];\r\n  let i = 0;\r\n  while (i < normalized.length) {\r\n    const rest = normalized.slice(i);\r\n    const m = rest.match(/^[^aeiouy]*[aeiouy]+/);\r\n    const chunk = m ? m[0] : rest[0];\r\n    if (chunk) {\r\n      parts.push(chunk);\r\n      i += chunk.length;\r\n    } else break;\r\n  }\r\n  const result = parts.length > 0 ? parts : [normalized];\r\n  return result.length <= 5 ? result : result.slice(0, 5);\r\n}\r\n"],"names":[],"mappings":"AAAA;;;CAGC;;;;AACM,SAAS,eAAe,IAAY;IACzC,MAAM,aAAa,KAAK,IAAI,GAAG,WAAW,GAAG,OAAO,CAAC,WAAW;IAChE,IAAI,CAAC,YAAY,OAAO;QAAC;KAAK;IAE9B,MAAM,QAAkB,EAAE;IAC1B,IAAI,IAAI;IACR,MAAO,IAAI,WAAW,MAAM,CAAE;QAC5B,MAAM,OAAO,WAAW,KAAK,CAAC;QAC9B,MAAM,IAAI,KAAK,KAAK,CAAC;QACrB,MAAM,QAAQ,IAAI,CAAC,CAAC,EAAE,GAAG,IAAI,CAAC,EAAE;QAChC,IAAI,OAAO;YACT,MAAM,IAAI,CAAC;YACX,KAAK,MAAM,MAAM;QACnB,OAAO;IACT;IACA,MAAM,SAAS,MAAM,MAAM,GAAG,IAAI,QAAQ;QAAC;KAAW;IACtD,OAAO,OAAO,MAAM,IAAI,IAAI,SAAS,OAAO,KAAK,CAAC,GAAG;AACvD"}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/app/api/practice/score/route.ts"],"sourcesContent":["/**\r\n * POST /api/practice/score\r\n * Scores transcript vs target word, returns accuracy, needsCorrection, syllables\r\n * Persists to MongoDB Attempts if sessionId/userId provided\r\n */\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { connectDb } from '../../../../lib/mongoose';\r\nimport Attempt from '../../../../lib/models/Attempt';\r\nimport { splitSyllables } from '../../../../lib/utils/syllables';\r\n\r\nfunction normalize(s: string): string {\r\n  return s.toLowerCase().replace(/[^a-z0-9]/g, '').trim();\r\n}\r\n\r\nfunction editDistance(a: string, b: string): number {\r\n  const m = a.length;\r\n  const n = b.length;\r\n  const dp: number[][] = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));\r\n  for (let i = 0; i <= m; i++) dp[i][0] = i;\r\n  for (let j = 0; j <= n; j++) dp[0][j] = j;\r\n  for (let i = 1; i <= m; i++) {\r\n    for (let j = 1; j <= n; j++) {\r\n      dp[i][j] = Math.min(\r\n        dp[i - 1][j] + 1,\r\n        dp[i][j - 1] + 1,\r\n        dp[i - 1][j - 1] + (a[i - 1] === b[j - 1] ? 0 : 1)\r\n      );\r\n    }\r\n  }\r\n  return dp[m][n];\r\n}\r\n\r\nfunction similarity(a: string, b: string): number {\r\n  const na = normalize(a);\r\n  const nb = normalize(b);\r\n  if (!na || !nb) return 0;\r\n  if (na === nb) return 1;\r\n  const maxLen = Math.max(na.length, nb.length);\r\n  const dist = editDistance(na, nb);\r\n  return Math.max(0, 1 - dist / maxLen);\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    const body = await request.json();\r\n    const { word, transcript, sessionId, userId } = body;\r\n    if (!word || typeof word !== 'string') {\r\n      return NextResponse.json({ error: 'Missing word' }, { status: 400 });\r\n    }\r\n    const trans = typeof transcript === 'string' ? transcript : '';\r\n\r\n    const sim = similarity(trans, word);\r\n    const accuracy = Math.round(Math.min(100, Math.max(0, sim * 100)));\r\n    const needsCorrection = accuracy < 90;\r\n    const syllables = splitSyllables(word);\r\n\r\n    if (sessionId && userId) {\r\n      try {\r\n        await connectDb();\r\n        await Attempt.create({\r\n          userId,\r\n          sessionId,\r\n          word,\r\n          syllables,\r\n          transcript: trans,\r\n          accuracy,\r\n          needsCorrection,\r\n        });\r\n      } catch (e) {\r\n        console.error('Attempt save error:', e);\r\n      }\r\n    }\r\n\r\n    return NextResponse.json({ accuracy, needsCorrection, syllables });\r\n  } catch (e) {\r\n    console.error('Score API error:', e);\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;;CAIC,GACD;AACA;AACA;AACA;;;;;AAEA,SAAS,UAAU,CAAS;IAC1B,OAAO,EAAE,WAAW,GAAG,OAAO,CAAC,cAAc,IAAI,IAAI;AACvD;AAEA,SAAS,aAAa,CAAS,EAAE,CAAS;IACxC,MAAM,IAAI,EAAE,MAAM;IAClB,MAAM,IAAI,EAAE,MAAM;IAClB,MAAM,KAAiB,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,GAAG,CAAC,IAAM,MAAM,IAAI,GAAG,IAAI,CAAC;IAC3E,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAK,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG;IACxC,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAK,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG;IACxC,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAK;QAC3B,IAAK,IAAI,IAAI,GAAG,KAAK,GAAG,IAAK;YAC3B,EAAE,CAAC,EAAE,CAAC,EAAE,GAAG,KAAK,GAAG,CACjB,EAAE,CAAC,IAAI,EAAE,CAAC,EAAE,GAAG,GACf,EAAE,CAAC,EAAE,CAAC,IAAI,EAAE,GAAG,GACf,EAAE,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,IAAI,EAAE,GAAG,IAAI,CAAC;QAErD;IACF;IACA,OAAO,EAAE,CAAC,EAAE,CAAC,EAAE;AACjB;AAEA,SAAS,WAAW,CAAS,EAAE,CAAS;IACtC,MAAM,KAAK,UAAU;IACrB,MAAM,KAAK,UAAU;IACrB,IAAI,CAAC,MAAM,CAAC,IAAI,OAAO;IACvB,IAAI,OAAO,IAAI,OAAO;IACtB,MAAM,SAAS,KAAK,GAAG,CAAC,GAAG,MAAM,EAAE,GAAG,MAAM;IAC5C,MAAM,OAAO,aAAa,IAAI;IAC9B,OAAO,KAAK,GAAG,CAAC,GAAG,IAAI,OAAO;AAChC;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,SAAS,EAAE,MAAM,EAAE,GAAG;QAChD,IAAI,CAAC,QAAQ,OAAO,SAAS,UAAU;YACrC,OAAO,yLAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QACA,MAAM,QAAQ,OAAO,eAAe,WAAW,aAAa;QAE5D,MAAM,MAAM,WAAW,OAAO;QAC9B,MAAM,WAAW,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,KAAK,KAAK,GAAG,CAAC,GAAG,MAAM;QAC5D,MAAM,kBAAkB,WAAW;QACnC,MAAM,YAAY,IAAA,sLAAc,EAAC;QAEjC,IAAI,aAAa,QAAQ;YACvB,IAAI;gBACF,MAAM,IAAA,uKAAS;gBACf,MAAM,8KAAO,CAAC,MAAM,CAAC;oBACnB;oBACA;oBACA;oBACA;oBACA,YAAY;oBACZ;oBACA;gBACF;YACF,EAAE,OAAO,GAAG;gBACV,QAAQ,KAAK,CAAC,uBAAuB;YACvC;QACF;QAEA,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE;YAAU;YAAiB;QAAU;IAClE,EAAE,OAAO,GAAG;QACV,QAAQ,KAAK,CAAC,oBAAoB;QAClC,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}