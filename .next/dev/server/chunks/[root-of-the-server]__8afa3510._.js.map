{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/lib/mongodb.ts"],"sourcesContent":["/**\r\n * MongoDB connection - uses MONGODB_URI env variable\r\n * Add to .env.local: MONGODB_URI=mongodb+srv://...\r\n */\r\nimport { MongoClient } from 'mongodb';\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nif (!uri) {\r\n  console.warn('MONGODB_URI not set - therapist dashboard will not persist');\r\n}\r\n\r\nlet client: MongoClient | null = null;\r\n\r\nexport async function getDb() {\r\n  if (!uri) throw new Error('MONGODB_URI not configured');\r\n  if (!client) client = new MongoClient(uri);\r\n  await client.connect();\r\n  return client.db();\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,IAAI,CAAC,KAAK;IACR,QAAQ,IAAI,CAAC;AACf;AAEA,IAAI,SAA6B;AAE1B,eAAe;IACpB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,IAAI,CAAC,QAAQ,SAAS,IAAI,6MAAW,CAAC;IACtC,MAAM,OAAO,OAAO;IACpB,OAAO,OAAO,EAAE;AAClB"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/app/api/dashboard/progress/route.ts"],"sourcesContent":["/**\r\n * GET /api/dashboard/progress?userId=...\r\n * Returns: attemptCount, avgAccuracy, soundsPracticedCount, bySound, bestSound, worstSound\r\n */\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { getDb } from '../../../../lib/mongodb';\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const uid = searchParams.get('userId') || 'default';\r\n\r\n    const db = await getDb();\r\n\r\n    const today = new Date();\r\n    today.setHours(0, 0, 0, 0);\r\n    const dailyAttempts = await db\r\n      .collection('attempts')\r\n      .find({ userId: uid, createdAt: { $gte: today } })\r\n      .count();\r\n    const dailyAttemptCount = dailyAttempts;\r\n\r\n    const attempts = await db\r\n      .collection('attempts')\r\n      .find({ userId: uid })\r\n      .project({ sound: 1, accuracy: 1 })\r\n      .toArray();\r\n\r\n    const attemptCount = attempts.length;\r\n\r\n    let avgAccuracy = 0;\r\n    if (attemptCount > 0) {\r\n      const sum = attempts.reduce((s, a) => s + a.accuracy, 0);\r\n      avgAccuracy = Math.round((sum / attemptCount) * 10) / 10;\r\n    }\r\n\r\n    const bySoundMap: Record<string, { sum: number; count: number }> = {};\r\n    for (const a of attempts) {\r\n      const s = (a.sound as string) || 'Other';\r\n      if (!bySoundMap[s]) bySoundMap[s] = { sum: 0, count: 0 };\r\n      bySoundMap[s].sum += a.accuracy;\r\n      bySoundMap[s].count += 1;\r\n    }\r\n\r\n    const bySound = Object.entries(bySoundMap).map(([sound, { sum, count }]) => ({\r\n      sound,\r\n      avgAccuracy: Math.round((sum / count) * 10) / 10,\r\n      attemptCount: count,\r\n    }));\r\n\r\n    const soundsPracticedCount = Object.keys(bySoundMap).length;\r\n\r\n    let bestSound: string | null = null;\r\n    let worstSound: string | null = null;\r\n\r\n    const withEnough = bySound.filter((b) => b.attemptCount >= 3);\r\n    const candidates = withEnough.length >= 2 ? withEnough : bySound;\r\n\r\n    if (candidates.length > 0) {\r\n      bestSound = candidates.reduce((a, b) => (a.avgAccuracy >= b.avgAccuracy ? a : b)).sound;\r\n      worstSound = candidates.reduce((a, b) => (a.avgAccuracy <= b.avgAccuracy ? a : b)).sound;\r\n    }\r\n\r\n    return NextResponse.json({\r\n      attemptCount,\r\n      avgAccuracy,\r\n      soundsPracticedCount,\r\n      bySound,\r\n      bestSound,\r\n      worstSound,\r\n    });\r\n  } catch (e) {\r\n    if (String(e).includes('MONGODB_URI')) {\r\n      return NextResponse.json({\r\n        attemptCount: 0,\r\n        dailyAttemptCount: 0,\r\n        avgAccuracy: 0,\r\n        soundsPracticedCount: 0,\r\n        bySound: [],\r\n        bestSound: null,\r\n        worstSound: null,\r\n      });\r\n    }\r\n    console.error('Dashboard progress error:', e);\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;AACA;;;AAEO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,MAAM,aAAa,GAAG,CAAC,aAAa;QAE1C,MAAM,KAAK,MAAM,IAAA,kKAAK;QAEtB,MAAM,QAAQ,IAAI;QAClB,MAAM,QAAQ,CAAC,GAAG,GAAG,GAAG;QACxB,MAAM,gBAAgB,MAAM,GACzB,UAAU,CAAC,YACX,IAAI,CAAC;YAAE,QAAQ;YAAK,WAAW;gBAAE,MAAM;YAAM;QAAE,GAC/C,KAAK;QACR,MAAM,oBAAoB;QAE1B,MAAM,WAAW,MAAM,GACpB,UAAU,CAAC,YACX,IAAI,CAAC;YAAE,QAAQ;QAAI,GACnB,OAAO,CAAC;YAAE,OAAO;YAAG,UAAU;QAAE,GAChC,OAAO;QAEV,MAAM,eAAe,SAAS,MAAM;QAEpC,IAAI,cAAc;QAClB,IAAI,eAAe,GAAG;YACpB,MAAM,MAAM,SAAS,MAAM,CAAC,CAAC,GAAG,IAAM,IAAI,EAAE,QAAQ,EAAE;YACtD,cAAc,KAAK,KAAK,CAAC,AAAC,MAAM,eAAgB,MAAM;QACxD;QAEA,MAAM,aAA6D,CAAC;QACpE,KAAK,MAAM,KAAK,SAAU;YACxB,MAAM,IAAI,AAAC,EAAE,KAAK,IAAe;YACjC,IAAI,CAAC,UAAU,CAAC,EAAE,EAAE,UAAU,CAAC,EAAE,GAAG;gBAAE,KAAK;gBAAG,OAAO;YAAE;YACvD,UAAU,CAAC,EAAE,CAAC,GAAG,IAAI,EAAE,QAAQ;YAC/B,UAAU,CAAC,EAAE,CAAC,KAAK,IAAI;QACzB;QAEA,MAAM,UAAU,OAAO,OAAO,CAAC,YAAY,GAAG,CAAC,CAAC,CAAC,OAAO,EAAE,GAAG,EAAE,KAAK,EAAE,CAAC,GAAK,CAAC;gBAC3E;gBACA,aAAa,KAAK,KAAK,CAAC,AAAC,MAAM,QAAS,MAAM;gBAC9C,cAAc;YAChB,CAAC;QAED,MAAM,uBAAuB,OAAO,IAAI,CAAC,YAAY,MAAM;QAE3D,IAAI,YAA2B;QAC/B,IAAI,aAA4B;QAEhC,MAAM,aAAa,QAAQ,MAAM,CAAC,CAAC,IAAM,EAAE,YAAY,IAAI;QAC3D,MAAM,aAAa,WAAW,MAAM,IAAI,IAAI,aAAa;QAEzD,IAAI,WAAW,MAAM,GAAG,GAAG;YACzB,YAAY,WAAW,MAAM,CAAC,CAAC,GAAG,IAAO,EAAE,WAAW,IAAI,EAAE,WAAW,GAAG,IAAI,GAAI,KAAK;YACvF,aAAa,WAAW,MAAM,CAAC,CAAC,GAAG,IAAO,EAAE,WAAW,IAAI,EAAE,WAAW,GAAG,IAAI,GAAI,KAAK;QAC1F;QAEA,OAAO,yLAAY,CAAC,IAAI,CAAC;YACvB;YACA;YACA;YACA;YACA;YACA;QACF;IACF,EAAE,OAAO,GAAG;QACV,IAAI,OAAO,GAAG,QAAQ,CAAC,gBAAgB;YACrC,OAAO,yLAAY,CAAC,IAAI,CAAC;gBACvB,cAAc;gBACd,mBAAmB;gBACnB,aAAa;gBACb,sBAAsB;gBACtB,SAAS,EAAE;gBACX,WAAW;gBACX,YAAY;YACd;QACF;QACA,QAAQ,KAAK,CAAC,6BAA6B;QAC3C,OAAO,yLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACF"}}]
}