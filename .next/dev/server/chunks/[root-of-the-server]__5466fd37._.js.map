{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/lib/mongodb.ts"],"sourcesContent":["/**\r\n * MongoDB connection - uses MONGODB_URI env variable\r\n * Add to .env.local: MONGODB_URI=mongodb+srv://...\r\n */\r\nimport { MongoClient } from 'mongodb';\r\n\r\nconst uri = process.env.MONGODB_URI;\r\nif (!uri) {\r\n  console.warn('MONGODB_URI not set - therapist dashboard will not persist');\r\n}\r\n\r\nlet client: MongoClient | null = null;\r\n\r\nexport async function getDb() {\r\n  if (!uri) throw new Error('MONGODB_URI not configured');\r\n  if (!client) client = new MongoClient(uri);\r\n  await client.connect();\r\n  return client.db();\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;;CAGC,GACD;;AAEA,MAAM,MAAM,QAAQ,GAAG,CAAC,WAAW;AACnC,IAAI,CAAC,KAAK;IACR,QAAQ,IAAI,CAAC;AACf;AAEA,IAAI,SAA6B;AAE1B,eAAe;IACpB,IAAI,CAAC,KAAK,MAAM,IAAI,MAAM;IAC1B,IAAI,CAAC,QAAQ,SAAS,IAAI,6MAAW,CAAC;IACtC,MAAM,OAAO,OAAO;IACpB,OAAO,OAAO,EAAE;AAClB"}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/10099/OneDrive/Documents/phonetically/app/api/dashboard/recommended/route.ts"],"sourcesContent":["/**\r\n * GET /api/dashboard/recommended?userId=...\r\n * Returns recommended sound: { sound, reason, avgAccuracy }\r\n * Logic: prefer lowest avgAccuracy sound (min 3 attempts if possible), else lowest recent\r\n */\r\nimport { NextRequest, NextResponse } from 'next/server';\r\nimport { getDb } from '../../../../lib/mongodb';\r\n\r\nconst DEFAULT_STARTER_SOUNDS = ['Short A', 'TH', 'R'];\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const uid = searchParams.get('userId') || 'default';\r\n\r\n    const db = await getDb();\r\n    const attempts = await db\r\n      .collection('attempts')\r\n      .find({ userId: uid })\r\n      .sort({ createdAt: -1 })\r\n      .project({ word: 1, sound: 1, accuracy: 1 })\r\n      .toArray();\r\n\r\n    if (attempts.length === 0) {\r\n      return NextResponse.json({\r\n        sound: DEFAULT_STARTER_SOUNDS[0],\r\n        reason: 'Get started with a common sound.',\r\n        avgAccuracy: null,\r\n      });\r\n    }\r\n\r\n    const bySound: Record<string, { sum: number; count: number }> = {};\r\n    for (const a of attempts) {\r\n      const s = (a.sound as string) || 'Other';\r\n      if (!bySound[s]) bySound[s] = { sum: 0, count: 0 };\r\n      bySound[s].sum += a.accuracy;\r\n      bySound[s].count += 1;\r\n    }\r\n\r\n    const withSound = Object.entries(bySound)\r\n      .filter(([s]) => s !== 'Other')\r\n      .map(([sound, { sum, count }]) => ({\r\n        sound,\r\n        avgAccuracy: sum / count,\r\n        count,\r\n      }));\r\n\r\n    const withEnough = withSound.filter((b) => b.count >= 3);\r\n    const pool = withEnough.length > 0 ? withEnough : withSound;\r\n\r\n    if (pool.length > 0) {\r\n      const worst = pool.reduce((a, b) => (a.avgAccuracy <= b.avgAccuracy ? a : b));\r\n      return NextResponse.json({\r\n        sound: worst.sound,\r\n        reason: `Based on your attempts, ${worst.sound} could use more practice.`,\r\n        avgAccuracy: Math.round(worst.avgAccuracy * 10) / 10,\r\n      });\r\n    }\r\n\r\n    const byWord: Record<string, { sum: number; count: number; sound?: string }> = {};\r\n    for (const a of attempts.slice(0, 20)) {\r\n      const w = a.word || 'unknown';\r\n      if (!byWord[w]) byWord[w] = { sum: 0, count: 0 };\r\n      byWord[w].sum += a.accuracy;\r\n      byWord[w].count += 1;\r\n      if ((a.sound as string) && !byWord[w].sound) byWord[w].sound = a.sound as string;\r\n    }\r\n    const wordList = Object.entries(byWord).map(([word, { sum, count, sound }]) => ({\r\n      word,\r\n      sound,\r\n      avgAccuracy: sum / count,\r\n    }));\r\n    const worst = wordList.reduce((a, b) => (a.avgAccuracy <= b.avgAccuracy ? a : b));\r\n    const fallbackSound = worst.sound || DEFAULT_STARTER_SOUNDS[0];\r\n    return NextResponse.json({\r\n      sound: fallbackSound,\r\n      reason: 'Based on your recent attempts.',\r\n      avgAccuracy: Math.round(worst.avgAccuracy * 10) / 10,\r\n    });\r\n  } catch (e) {\r\n    if (String(e).includes('MONGODB_URI')) {\r\n      return NextResponse.json({\r\n        sound: 'Short A',\r\n        reason: 'Get started with a common sound.',\r\n        avgAccuracy: null,\r\n      });\r\n    }\r\n    console.error('Dashboard recommended error:', e);\r\n    return NextResponse.json({ error: 'Internal server error' }, { status: 500 });\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}